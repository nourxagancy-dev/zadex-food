# خطة التنفيذ خطوة بخطوة

خارطة طريق عملية لتحويل المخطط المعماري إلى منتج قابل للنشر على استضافة مشتركة. مرتبة على مراحل قصيرة، مع مخرجات واضحة وقوائم تحقق سريعة.

## المرحلة 1: إعداد الأساس (Backend)
- إنشاء مشروع Laravel وتفعيل Sanctum.
- تهيئة المصادقة للأدمن: تسجيل دخول/خروج/`me` باستخدام جلسات أو توكنات.
- إنشاء هياكل الجداول من `docs/database-schema.sql` عبر Migrations مع Seeding للأدوار وصلاحيات (Owner/Manager/Cashier/Kitchen).
- إعداد رفع الملفات `storage/app/public` وربط `storage:link`.
- تفعيل النسخ الأولي لـ API v1 (`/api/v1/...`) مع Middlewares للـ tenant (subdomain أو `restaurant_slug`).

### مخرجات المرحلة
- تشغيل `php artisan migrate --seed` بنجاح.
- مسارات auth + health check تعمل.
- مصادقة الأدمن عبر Sanctum.

## المرحلة 2: إدارة المطعم (Backend)
- CRUD للأقسام والمنتجات ومجموعات الخيارات (min/max/required) مع الفالديشن.
- ربط المنتجات بمجموعات الخيارات عبر جدول وسيط وحفظ حدود الاختيار.
- إعداد الإعدادات العامة لكل مطعم/فرع (اسم، شعار، ضريبة، توصيل، أوقات العمل، حالة مفتوح/مغلق، رقم واتساب).
- نقاط نهاية إدارة المستخدمين والأدوار.
- تفعيل CORS للـ Admin/Customer.

### مخرجات المرحلة
- مسارات CRUD للإدارة تعمل ومحمية.
- رفع الصور وحفظ روابطها العامة.
- إعدادات المطعم تُقرأ وتُحدّث عبر API.

## المرحلة 3: الطلبات والمدفوعات (Backend)
- بناء دورة حياة الطلب: pending → confirmed → preparing → ready → on_the_way → completed/cancelled.
- شاشة المطبخ: Endpoint polling كل 5 ثواني (أو WebSockets إذا توفر).
- الكوبونات (percentage/fixed) مع شروط حد أدنى، صلاحية، عدد استخدام، ربط اختياري بفرع/قسم/منتج.
- تكامل Paymob: إنشاء جلسة + Webhook لتحديث الحالة.
- تدفق فوري/Vodafone Cash: حالة waiting_payment + رفع إثبات تحويل اختياري.
- توليد رسالة واتساب جاهزة بعد إنشاء الطلب وفتح wa.me.

### مخرجات المرحلة
- إنشاء الطلب يحفظ العناصر والإضافات ويولد رقم فريد.
- حالات الطلب تتغير عبر Endpoint إدارة.
- Webhook Paymob يحدّث الحالة تلقائياً.
- رسالة واتساب ترسل البيانات الكاملة.

## المرحلة 4: لوحة التحكم (Vue 3 + Vite + Bootstrap 5 RTL)
- شاشة تسجيل الدخول + Dashboard ببطاقات الحالة والإجراءات السريعة.
- صفحات CRUD للأقسام، المنتجات، مجموعات الخيارات، الكوبونات.
- شاشة الطلبات + تفاصيل + تغيير حالة + شاشة مطبخ حي.
- إعدادات المطعم والواتساب + إدارة المستخدمين.
- UX: Toasts، Dialogs تأكيد، Skeletons، استجابة كاملة.
- ربط مع API v1 + حماية المسارات (Vue Router + Pinia أو store مكافئ).

### مخرجات المرحلة
- بناء `npm run build` يخرج إلى `/public/admin` (تحضير لـ cPanel).
- RTL كامل وخط Cairo وتصميم Glassmorphism بنفسجي.
- لا توجد أخطاء Console حرجة.

## المرحلة 5: واجهة العميل (React + Vite + Bootstrap 5 RTL + PWA)
- صفحات: المنيو الرئيسية، عرض قسم، تفاصيل منتج مع تحقق min/max، السلة، الدفع.
- تدفق الطلب: بيانات العميل، نوع الطلب (توصيل/استلام)، طريقة الدفع (عند الاستلام، Paymob، فوري، Vodafone Cash)، تطبيق كوبون.
- PWA: manifest + service worker للتخزين المؤقت، Offline fallback يعرض آخر منيو مخزن + رسالة بدون اتصال، Add to Home Screen.
- SEO: Meta/Og + روابط نظيفة للمنتجات والأقسام.
- فتح واتساب برسالة الطلب عند الإتمام.

### مخرجات المرحلة
- بناء `npm run build` يخرج إلى `/public/menu` (تحضير لـ cPanel).
- التحقق من الخيارات (min/max/required) يعمل قبل إضافة للسلة والدفع.
- PWA تعمل (Offline + A2HS).

## المرحلة 6: النشر على استضافة مشتركة
- رفع Laravel إلى `/backend` وتشغيل Composer وإعداد `.env`.
- ربط `storage:link` + ضبط صلاحيات التخزين.
- نشر Build الـ Admin في `/public/admin` وبناء React في `/public/menu`.
- ضبط CORS وAPP_URL/SESSION_DOMAIN/subdomain أو `restaurant_slug`.
- تفعيل Cron (إن توفر) لتنظيف التوكنات والجلسات.

### مخرجات المرحلة
- التطبيق يعمل على الدومين مع روابط admin/menu.
- الطلبات تحفظ وتُرسل عبر واتساب، والدفع يعمل (أو التعليمات اليدوية ظاهرة).
- التقارير الأساسية تعمل (مبيعات يوم/أسبوع/شهر + أكثر المنتجات مبيعاً + متوسط قيمة الطلب).

## قوائم تحقق سريعة
- [ ] Sanctum + Auth + أدوار.
- [ ] CRUD كاملة مع رفع ملفات.
- [ ] دورة حياة الطلب + الكوبونات + المدفوعات + واتساب.
- [ ] Vue Admin RTL + Glassmorphism + حماية المسارات.
- [ ] React Customer PWA + Offline + SEO.
- [ ] نشر cPanel مع CORS وstorage:link.
